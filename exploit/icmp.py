from scapy.all import *

ICMP_types = {0: "Echo-Reply", 8: "Echo-Request"}


def print_ICMP(trame):  # on définie le programme
    type = trame[0][2].type  # prend la valeur du champ type de l'en tête icmp
    if type == 0 or type == 8:  # teste si bien echo reply ou request
        print(trame.summary())  # résumé de la trame
        print(f"ICMP: Type: {ICMP_types[type]}")
        print(f"Ethernet: MAC Source : {trame[0][0].src}")
        print(f"Ethernet: MAC Destination : {trame[0][0].dst}")
        print(f"IPv4 : IP Source : {trame[0][1].src}")
        print(f"IPv4 : IP Destination : {trame[0][1].dst}")
        print("\n")


carte = conf.iface  # définie l'interface réseau active

print(f"On commence le 'sniffing' sur la carte {carte}:")
print("\n")
sniff(filter="icmp", prn=print_ICMP, store=0, iface=carte, count=4)
